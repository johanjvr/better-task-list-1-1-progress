@model BetterTaskList.Models.Ticket

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_ContentSideBar.cshtml";
}

<div id="content">

    <h2 class="entry-title">Ticket #@Model.TicketId - @Model.TicketSubject</h2>
    
    <div class="post-info">
        <span title="@Model.TicketLastUpdated" class="date published time">@Model.TicketCreatedDate.Value.ToString("F")</span>  by 
        <span class="author vcard">
            <span class="fn">
                <a href="#" id="toggle-author-box">@BetterTaskList.Helpers.UserHelpers.GetUserFullName(Model.TicketCreatorUserId) </a> 
                @* @Html.ActionLink(BetterTaskList.Helpers.UserHelpers.GetUserFullName(Model.TicketCreatorUserId), "Profile", "Home", new { area = "", id = Model.TicketCreatorUserId }, new { @Style = "text-decoration:none" })*@
                @Html.Partial("_DisplayTicketDueDate")
            </span>
        </span>
    </div>

    <div id="author-box" style="display:none;" class="author-box">
        <div>
            <img height="64" width="64" class="avatar avatar-70 photo" src="@Url.Content(BetterTaskList.Helpers.UserHelpers.GetUserAvatarUrl(Model.TicketCreatorUserId, "64x64"))" title="" alt="" />
            <strong>About the ticket creator (@BetterTaskList.Helpers.UserHelpers.GetUserFullName(Model.TicketCreatorUserId))</strong>
            <br />
            @Html.Raw(BetterTaskList.Helpers.UserHelpers.GetUserProfile(Model.TicketCreatorUserId).AboutMe)
        </div>
    </div>

    <div class="entry-content">
            @Html.Raw(Model.TicketDescription)
    </div>

    @if (Model.TicketStatus == "CLOSED")
    {
    <div class="entry-content" style="background-color:#FCF0BA; border:1px solid #E8E1B5;">
            @Html.Partial("_DisplayTicketResolution")
    </div>
    }
    

    <div class="post-info" style="text-align:right">
        @Html.ActionLink("Edit", "Edit", new { id = Model.TicketId }) |
        @Html.ActionLink("Delete", "Delete", new { id = Model.TicketId })
        or
        <a href="#" id="ToggleResolveTicket">Resolve</a>
    </div>


    <div class="clear"></div>

    <div id="ResolveTicket" style="display:none;">
    <div id="tabs">
	    <ul>
		    <li class="ui-tabs-selected ui-state-active"><a href="#tabs-1">Resolve</a></li>
	    </ul>
	    <div id="tabs-1">
                @Html.Partial("_TicketResolution")
	    </div>
    </div>
    </div>

    @Html.Partial("_DisplayComment")

    <h3 id="reply-title">Write a comment</h3>
    <div id="commentTab">
        <ul>
             <li class="ui-tabs-selected ui-state-active"><a href="#comment-tab">Comment</a></li>
        </ul>
        <div id="comment-tab">
            @Html.Partial("_PostComment")
        </div>
    </div>

</div>

<div id="sidebar" class="sidebar widget-area">
    <div style="width:269px;">@Html.Partial("_TicketAttachments")</div>
</div>

<script type="text/javascript">
    $(function () {
        $("#tabs").tabs();
        $("#commentTab").tabs();
        $("#SubmitComment").button();
        $("#SubmitResolution").button();

        $("#toggle-author-box").click(function () {
            $("#author-box").toggle('clip', null, 500);
            return false;
        });

        $("#SubmitComment").button();

        $("#ToggleResolveTicket").click(function () {
            $("#ResolveTicket").toggle('clip', null, 500);
            return false;
        });

    });
</script>

